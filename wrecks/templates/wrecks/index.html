<head>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.2/dist/leaflet.css"
     integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14="
     crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.2/dist/leaflet.js"
    integrity="sha256-o9N1jGDZrf5tS+Ft4gbIK7mYMipq9lqpVJ91xHSyKhg="
    crossorigin=""></script>
</head>

<body>
  <div id="map" style="height: 100%; width: 100%;"></div>
  <script>
    var ocean_base = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer/tile/{z}/{y}/{x}',
      {
	      attribution: 'Tiles &copy; Esri &mdash; Sources: GEBCO, NOAA, CHS, OSU,   UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri',
	      maxZoom: 13
      });
    var noaa_enc = L.tileLayer.wms(
      "https://gis.charttools.noaa.gov/arcgis/rest/services/MCS/NOAAChartDisplay/MapServer/exts/MaritimeChartService/WMSServer",
      {
        layer: ['0', '1', '2', '3', '4', '5', '6', '10'],
        maxZoom: 19,
        attribution: 'NOAA'
      });
    const map = L.map(
      'map',
      {'center': [41.47, -71.35],
       'zoom':  12,
       'layers': [ocean_base, noaa_enc]});
    var layerControl = L.control.layers(
      {"ESRI Ocean Base" : ocean_base, "NOAA ENC": noaa_enc}, {}).addTo(map);
  </script>
  {% if wrecks_list %}
      {% for wreck in wrecks_list %}
          <script>
            var marker = L.marker(
              ["{{ wreck.latitude }}", "{{ wreck.longitude }}"]
              ).addTo(map);
            var wh_link = "{% if wreck.wreckhunter_link %}<a href={{ wreck.wreckhunter_link }} target=\"_blank\" rel=\"noopener noreferrer\" >Datasheet</a>{% else %}{% endif %}";
            var bl_link = "{% if wreck.beavertail_link %}<a href={{ wreck.beavertail_link }} target=\"_blank\" rel=\"noopener noreferrer\" >Datasheet</a>{% else %}{% endif %}";
            var name = "<strong>{{ wreck.vessel_name }}</strong>";
            var year =  "{% if wreck.year > 0 %}{{wreck.year}}{%endif%}";
            var msg_box = name;
            if (year !== "") {
              msg_box += "<br>Year Lost: " + year + "</br>";
            }
            if (wh_link.length > 0 || bl_link.length > 0) {
              msg_box += "<br>There is more information available at the following resources. Note: all data at the following links is from external sources, please refer to the linked sources for usage or reproduction constraints.</br>";
              msg_box += "<ul>";
              if (wh_link.length > 0) {
                msg_box += "<li>Wreck Hunter (<a href='http://wreckhunter.net/' target=\"_blank\" rel=\"noopener noreferrer\">Website</a>, " + wh_link + ")</li>"; 
              }
              if (bl_link.length > 0) {
                msg_box += "<li>Beavertail Lighthouse Museum (<a href='https://beavertaillight.org/wrecks/' target=\"_blank\" rel=\"noopener noreferrer\">Website</a>, " + bl_link + ")</li>";
              }
              msg_box += "</ul>";
            } else {
              msg_box += "<br>There are no datasheets or references available for this wreck...yet :) .</br>"
            }
            marker.bindPopup(msg_box);
          </script>
      {% endfor %}
  {% else %}
      <p>No wrecks in are available.</p>
  {% endif %}
</body>